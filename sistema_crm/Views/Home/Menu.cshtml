@model HomeModel

@{
    ViewData["Title"] = "Menu";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="apple-touch-icon" sizes="76x76" href="~/lib/bootstrap/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="~/lib/bootstrap/assets/img/favicon.png" />
    <title>
        Cadastro de Vendedores
    </title>
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet" />
    <!-- Nucleo Icons -->
    <link href="../assets/css/nucleo-icons.css" rel="stylesheet" />
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- Font Awesome Icons -->
    <script src="https://kit.fontawesome.com/42d5adcbca.js" crossorigin="anonymous"></script>
    <link href="../assets/css/nucleo-svg.css" rel="stylesheet" />
    <!-- CSS Files -->
    <link id="pagestyle" href="~/lib/bootstrap/assets/css/soft-ui-dashboard.css" rel="stylesheet" />
    <!-- Nepcha Analytics (nepcha.com) -->
    <!-- Nepcha is a easy-to-use web analytics. No cookies and fully compliant with GDPR, CCPA and PECR. -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js" integrity="sha512-3gJwYpMe3QewGELv8k/BX9vcqhryRdzRMxVfq6ngyWXwo03GFEzjsUm8Q7RZcHPHksttq7/GFoxjCVUjkjvPdw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.min.js" integrity="sha512-XtmMtDEcNz2j7ekrtHvOVR4iwwaD6o/FUJe6+Zq+HgcCsk3kj4uSQQR8weQ2QVj1o0Pk6PwYLohm206ZzNfubg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.16/jquery.mask.min.js" integrity="sha512-pHVGpX7F/27yZ0ISY+VVjyULApbDlD0/X0rgGbTqCE7WFW5MezNTWG/dnhtbBuICzsd0WQPgpE4REBLv+UqChw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>

        jQuery(function ($) {
            $('#cpf').mask('000.000.000-00');
            $('#cnpj').mask('00.000.000/0000-00');
            $('#telefone').mask('(00) 00000-0000');
        })
    </script>
    <style>
        .input {
            display: inline-block; /* Define as caixas de texto para exibição em linha */
            width: 150px; /* Largura das caixas de texto */
            margin-right: 10px; /* Espaçamento entre as caixas de texto */
        }

        .sidenav {
            height: 100%; /* Full-height: remove this if you want "auto" height */
            width: 160px; /* Set the width of the sidebar */
            position: fixed; /* Fixed Sidebar (stay in place on scroll) */
            z-index: 0; /* Stay on top */
            top: 0; /* Stay at the top */
            left: auto;
            background-color: #fff; /* Black */
            overflow-x: hidden; /* Disable horizontal scroll */
            padding-top: 50px;
        }

        .crm {
            margin-top: 20px;
        }

        /* Centralização dos textos no card */


        /* Cor do valor em rosa */


        .vendas-valor {
            color: #CB0C9F;
        }

        /* Estilos da barra de progresso */
        .barra-progresso {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            height: 20px;
            margin-top: 10px;
        }

        .barra-preenchida {
            height: 100%;
            text-align: center;
            color: white;
            font-weight: bold;
            line-height: 20px;
            border-radius: 5px;
        }
    </style>

    </style>
    <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>
    <script defer data-site="YOUR_DOMAIN_HERE" src="https://api.nepcha.com/js/nepcha-analytics.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>



<body class="g-sidenav-show  bg-gray-100">





    <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg">

        <header>
            <nav class="navbar navbar-main navbar-expand-lg px-0 mx-4 shadow-sm border-radius-xl bg-white mb-4">
                <div class="container-fluid py-2 px-3">
                    <div class="d-flex align-items-center">
                        <!-- Ícone atualizado para Dashboard com margem adicional -->
                        <i class="bi bi-grid-3x3-gap fs-3 text-primary me-4"></i> <!-- Para Bootstrap Icons -->
                        <!-- <i class="fas fa-chart-line fs-3 text-primary me-4"></i> --> <!-- Para Font Awesome -->
                        <h6 class="font-weight-bold mb-0 text-dark">Dashboard</h6>
                    </div>
                </div>
            </nav>


                    <div />

                    <div class="collapse navbar-collapse mt-sm-0 mt-2 me-md-0 me-sm-4" id="navbar">
                        <div class="ms-md-auto pe-md-3 d-flex align-items-center">
                        </div>
                        <div class="navbar-collapse collapse">
                            @*<ul class="nav navbar-nav">
                            <li><a asp-area="" asp-controller="Home" asp-action="Index">Home</a></li>
                            <li><a asp-area="" asp-controller="Home" asp-action="About">About</a></li>
                            <li><a asp-area="" asp-controller="Home" asp-action="Contact">Contact</a></li>
                            <li><a asp-area="" asp-controller="Home" asp-action="Login">Entrar no Sistema</a></li>
                            </ul>*@
                            @*  @using Microsoft.AspNetCore.Http
                            @inject IHttpContextAccessor HttpContextAccessor *@
                            <div id="NomeUsuarioLogado"></div>
                            <div class="navbar-nav  justify-content-end">
                                <div class=" navbar-nav flex-grow-1 justify-content-end">
                                    <ul class="navbar-nav flex-grow-1 justify-content-end" style="margin-right:auto;">
                                    </ul>
                                </div>
                                <div />
                            </div>
                        </div>

                    </div>
            </nav>





        </header>

        <div class="container-fluid">
            <div class="d-flex justify-content-between mb-4 gap-3">
                <!-- Primeiro bloco: Meta do mês -->
                <div class="card text-center shadow-sm align-self-stretch d-flex align-items-center justify-content-center" style="flex: 1; padding: 10px;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <h5 class="font-weight-bold text-primary">
                            <i class="fas fa-bullseye text-warning"></i> <!-- Ícone de meta em amarelo -->
                            Meta do Mês
                        </h5>
                        <span id="metaValor" class="h5 text-success">
                            <i class="fas fa-chart-line text-success"></i> <!-- Ícone de crescimento em verde -->
                            R$ 50.000,00
                        </span>
                        <h3 class="progresso mt-3">
                            <span class="vendas-valor text-muted">
                                <i class="fas fa-dollar-sign text-muted"></i> <!-- Ícone de valor em cinza -->
                                R$ 0,00
                            </span>
                        </h3>
                        <div class="barra-progresso mt-3">
                            <div class="barra-preenchida" style="width: 0%;">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Segundo bloco: Valor em Negociação -->
                <div class="card shadow-sm rounded align-self-stretch d-flex align-items-center justify-content-center" style="flex: 1;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <!-- Título -->
                        <div class="text-center mb-2">
                            <h6 class="text-primary font-weight-bold">Valor em Negociação</h6>
                        </div>

                        <!-- Ícone abaixo do Título -->
                        <div class="text-center mb-3">
                            <i class="fas fa-balance-scale fa-2x text-warning"></i> <!-- Ícone representando negociação em amarelo -->
                        </div>

                        <!-- Valor em Negociação -->
                        <p class="h4 font-weight-bold text-dark mb-0">
                            @try
                            {
                                @ViewBag.Negociacao.ToString("C")
                            }
                            catch { }
                        </p>
                    </div>
                </div>

                <!-- Terceiro bloco: Total de Propostas e Vendas Realizadas -->
                <div class="card shadow-sm rounded p-4 align-self-stretch" style="flex: 1;">
                    <div class="card-body d-flex flex-column align-items-center justify-content-center">
                        <!-- Título do Mês -->
                        <h5 class="text-center font-weight-bold text-primary mb-4">@ViewBag.Conversao.Mes</h5>

                        <!-- Informações de Total de Propostas e Vendas Realizadas com Divisor -->
                        <div class="d-flex justify-content-around align-items-center mb-4">
                            <!-- Total de Propostas -->
                            <div class="text-center mx-3">
                                <i class="fas fa-file-alt fa-2x text-info mb-2"></i> <!-- Ícone de Propostas -->
                                <p class="font-weight-bold text-secondary mb-0">Total de Propostas</p>
                                <p class="h5 text-dark mb-0">@ViewBag.Conversao.TotalProposta</p>
                            </div>

                            <!-- Divisor Vertical -->
                            <div class="border-start mx-3" style="height: 60px; border-color: #ddd;"></div>

                            <!-- Vendas Realizadas -->
                            <div class="text-center mx-3">
                                <i class="fas fa-handshake fa-2x text-success mb-2"></i> <!-- Ícone de Vendas Realizadas -->
                                <p class="font-weight-bold text-secondary mb-0">Vendas Realizadas</p>
                                <p class="h5 text-dark mb-0">@ViewBag.Conversao.TotalPropostaVendas</p>
                            </div>
                        </div>

                        <!-- Índice de Aproveitamento -->
                        <div class="text-center mt-3">
                            <p class="font-weight-bold text-secondary mb-2">Índice de Aproveitamento</p>
                            @if (ViewBag.Conversao.TotalProposta > 0)
                            {
                                var aproveitamento = (double)ViewBag.Conversao.TotalPropostaVendas / ViewBag.Conversao.TotalProposta * 100;
                                <div class="progress" style="height: 10px; border-radius: 5px; overflow: hidden;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: @aproveitamento%; transition: width 0.5s ease;">
                                    </div>
                                </div>
                            }
                            else
                            {
                                <p class="text-muted">Nenhum dado disponível para calcular o aproveitamento.</p>
                            }
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- Gráfico Vendas 3 meses -->
        <div class="d-flex justify-content-between">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h4 class="text-center font-weight-bold text-primary mb-3">Vendas dos Últimos 3 Meses</h4>
                <div id="canvas-holder" class="d-flex justify-content-center">
                    <canvas id="vendas3mesesChart" class="chart-canvas" width="600" height="300"></canvas>
                </div>
            </div>
            
        </div>

        <div class="card shadow-sm mb-4">
            <h4 class="text-center font-weight-bold text-primary mb-3">Status</h4>
            <div id="canvas-holder" class="d-flex justify-content-center">
                <canvas id="graficoStatus" class="chart-canvas"></canvas>
            </div>
        </div>
        </div>
        <!-- Bloco abaixo: Top 5 Vendedores por Valor de Vendas -->
        <div class="card shadow-sm">
            <div class="card-body">
                <h6 class="font-weight-bold text-primary">Top 5 Vendedores por Valor de Vendas</h6>
                <table class="table table-striped mt-3">
                    <thead class="thead-light">
                        <tr>
                            <th scope="col">Posição</th>
                            <th scope="col">Vendedor</th>
                            <th scope="col">Valor Total de Vendas</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.RankingVendas != null)
                        {
                            var ranking = (List<VendedorModel>)ViewBag.RankingVendas;
                            for (int i = 0; i < Math.Min(5, ranking.Count); i++)
                            {
                                <tr>
                                    <td>@(i + 1)</td>
                                    <td>@ranking[i].Nome</td>
                                    <td>@ranking[i].ValorVendas.ToString("C")</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center">Nenhum dado disponível.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
       

        <!-- Scripts necessários -->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
        <script>
            $(document).ready(function () {
                // Função para buscar o progresso das vendas do mês
                function atualizarProgressoVendasDoMes() {
                    $.ajax({
                        url: '/Vendedor/ObterProgressoVendas',
                        type: 'GET',
                        success: function (data) {
                            if (data && data.totalVendas !== undefined && data.meta !== undefined) {
                                let totalVendasFormatado = parseFloat(data.totalVendas).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                                let metaFormatada = parseFloat(data.meta).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                                $('#metaValor').text(metaFormatada);
                                $('.vendas-valor').text(totalVendasFormatado);

                                let progressoPercent = Math.min(Math.round((data.totalVendas / data.meta) * 100), 100);
                                let progressoText = progressoPercent + '%';

                                // Atualiza a largura da barra e define a cor com base no progresso
                                let barra = $('.barra-preenchida');
                                barra.css('width', progressoText).text(progressoText);

                                if (progressoPercent < 60) {
                                    barra.css('background-color', 'red');
                                } else if (progressoPercent < 95) {
                                    barra.css('background-color', 'yellow');
                                } else {
                                    barra.css('background-color', 'green');
                                }
                            } else {
                                alert("Resposta inválida do servidor.");
                            }
                        },
                        error: function () {
                            alert("Erro ao carregar o valor total de vendas.");
                        }
                    });
                }

                // Chama a função de atualização ao carregar a página
                atualizarProgressoVendasDoMes();
            });
        </script>


        <script>
            // Gráfico de Vendas dos 3 Últimos Meses
            var labels = [@Html.Raw(ViewBag.Labels)];
            var valores = [@Html.Raw(ViewBag.Valores)];

            // Filtra os últimos 3 elementos
            labels = labels.slice(-3);
            valores = valores.slice(-3);

            var ctx = document.getElementById('vendas3mesesChart').getContext('2d');
            var vendasChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Vendas dos Últimos 3 Meses',
                        data: valores,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 2,
                        tension: 0.3,
                        pointBackgroundColor: 'rgba(75, 192, 192, 1)',
                        pointBorderColor: 'rgba(75, 192, 192, 1)',
                        pointBorderWidth: 2,
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        datalabels: {
                            display: true,
                            align: 'top',
                            formatter: function (value) {
                                return value.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
                            },
                            color: '#333',
                            font: { weight: 'bold' },
                            anchor: 'end',
                            clamp: true
                        },
                        title: {
                            display: true,
                            font: { size: 18 },
                            padding: { top: 10, bottom: 30 }
                        },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function (tooltipItem) {
                                    return tooltipItem.raw.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
                                }
                            }
                        }
                    },
                    scales: {
                        y: { display: false, beginAtZero: true },
                        x: { grid: { display: false } }
                    }
                },
                plugins: [ChartDataLabels]
            });
        </script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>

            // Gráfico de Status de Vendas
            var labels = [@Html.Raw(ViewBag.Labels1)];
            var valores = [@Html.Raw(ViewBag.Valores1)];
            var cores = [@Html.Raw(ViewBag.Cores1)]; // Mantendo as cores do backend diretamente

            // Configuração do gráfico de rosca com Chart.js
            var ctx = document.getElementById('graficoStatus').getContext('2d');
            var graficoStatus = new Chart(ctx, {
                type: 'doughnut',  // Define o gráfico como rosca
                data: {
                    labels: labels,
                    datasets: [{
                        data: valores,
                        backgroundColor: cores,  // Usando as cores diretamente
                        borderColor: '#FFFFFF',  // borda branca para sofisticação
                        borderWidth: 2,
                        hoverBorderColor: '#000000'  // borda preta ao passar o mouse para destaque
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',  // Define a espessura do gráfico, mantendo o centro vazio
                    plugins: {
                        legend: {
                            position: 'bottom',  // Move a legenda para baixo
                            labels: {
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#333'  // Cor do texto da legenda
                            }
                        },
                        title: {
                            display: true,                         
                            font: { size: 20, weight: 'bold', family: 'Arial' },
                            color: '#333',
                            padding: { top: 10, bottom: 20 }
                        },
                        tooltip: {
                            enabled: true,
                            backgroundColor: 'rgba(0, 0, 0, 0.7)',
                            titleFont: { size: 16, weight: 'bold' },
                            bodyFont: { size: 14 },
                            callbacks: {
                                label: function(tooltipItem) {
                                    return labels[tooltipItem.dataIndex] + ': ' + valores[tooltipItem.dataIndex].toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
                                }
                            }
                        }
                    }
                }
            });
        </script>
    </main>
</body>